This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
app/[store_id]/blog/page.tsx
app/[store_id]/page.tsx
app/admin/[store_id]/page.tsx
app/admin/actions.ts
app/api/blog/route.ts
app/api/crawl/route.ts
app/api/diagnosis/route.ts
app/api/search/route.ts
app/api/trend/route.ts
app/favicon.ico
app/globals.css
app/layout.tsx
app/llms.txt/route.ts
app/page.tsx
app/sitemap.ts
eslint.config.mjs
next.config.ts
package.json
postcss.config.mjs
public/file.svg
public/globe.svg
public/next.svg
public/vercel.svg
public/window.svg
README.md
test-firecrawl.mjs
tsconfig.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="app/api/blog/route.ts">
import { GoogleGenerativeAI } from '@google/generative-ai';
import { NextResponse } from 'next/server';

const MODEL_NAME = "gemini-2.0-flash-exp";

export async function POST(req: Request) {
  try {
    // concept: íŠ¸ë Œë“œ APIì—ì„œ ë§Œë“  ê¸°íšì•ˆ ê°ì²´ { title, description, keywords }
    const { title, content, category, source_url, concept } = await req.json();

    const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY || "");
    const model = genAI.getGenerativeModel({ model: MODEL_NAME });

    console.log(`âœï¸ [ë¸”ë¡œê·¸ ì‘ê°€] ì£¼ì œ: ${title} / ì»¨ì…‰: ${concept.title}`);

    const prompt = `
      ë„ˆëŠ” ë„¤ì´ë²„ íŒŒì›Œë¸”ë¡œê±°ì•¼.
      ì´ë²ˆì—ëŠ” **"${concept.title}"** ë¼ëŠ” íŠ¹ë³„í•œ ê¸°íš ì˜ë„ë¥¼ ê°€ì§€ê³  ê¸€ì„ ì¨ì•¼ í•´.

      **[ê¸°íš ì˜ë„]**
      ${concept.description}
      
      **[ê°€ê²Œ ì •ë³´]**
      - ìƒí˜¸ëª…: ${title}
      - ì¹´í…Œê³ ë¦¬: ${category}
      - ë‚´ìš©: ${content}
      - ì°¸ê³ : ${source_url}

      **[ì‘ì„± ê°€ì´ë“œ]**
      1. **ì œëª©:** ê¸°íš ì˜ë„ë¥¼ ì‚´ë¦° **ë§¤ë ¥ì ì¸ ì œëª© 3ê°œ** ì œì•ˆ.
      2. **ë³¸ë¬¸:** - ë„ì…ë¶€ì—ì„œ **í˜„ì¬ ì‹œì¦Œ/íŠ¸ë Œë“œ(${concept.keywords.join(', ')})** ì´ì•¼ê¸°ë¥¼ êº¼ë‚´ë©° ìì—°ìŠ¤ëŸ½ê²Œ ì‹œì‘í•´.
         - ì‚¬ì¥ë‹˜ì´ ì˜ë„í•œ ì»¨ì…‰(ì˜ˆ: í•«íŒ© ëŒ€ìš©, ë°ì´íŠ¸ ì½”ìŠ¤ ë“±)ì— ë§ì¶°ì„œ ë©”ë‰´ì™€ ê°€ê²Œë¥¼ ë¬˜ì‚¬í•´ì¤˜.
      3. **ì‚¬ì§„ ê°€ì´ë“œ:** (ğŸ“¸ ...) í¬í•¨.
      4. **í‚¤ì›Œë“œ:** ${concept.keywords.join(', ')} ë° "${title}"ë¥¼ ë³¸ë¬¸ì— 5íšŒ ì´ìƒ ìì—°ìŠ¤ëŸ½ê²Œ ë…¹ì—¬ë‚´.
      5. **í†¤ì•¤ë§¤ë„ˆ:** ê°ì„±ì ì´ë©´ì„œë„ íŠ¸ë Œë””í•œ ë§íˆ¬.

      **[ì¶œë ¥]**
      ì¤„ê¸€ í˜•íƒœë¡œ ì‘ì„±.
    `;

    const result = await model.generateContent(prompt);
    const blogPost = await result.response.text();

    return NextResponse.json({ success: true, post: blogPost });

  } catch (error: any) {
    return NextResponse.json({ success: false, error: error.message }, { status: 500 });
  }
}
</file>

<file path="app/api/crawl/route.ts">
import FirecrawlApp from '@mendable/firecrawl-js';
import { GoogleGenerativeAI } from '@google/generative-ai';
import { createClient } from '@supabase/supabase-js';
import { NextResponse } from 'next/server';

const MODEL_CANDIDATES = [
  "gemini-2.0-flash-exp", 
  "gemini-1.5-flash",
  "gemini-1.5-flash-latest"
];

function extractAndParseJSON(text: string) {
  try {
    let cleanText = text.replace(/```json|```/g, "").trim();
    const firstSquare = cleanText.indexOf('[');
    const firstCurly = cleanText.indexOf('{');
    let startIndex = -1;
    let endIndex = -1;

    if (firstSquare !== -1 && (firstSquare < firstCurly || firstCurly === -1)) {
      startIndex = firstSquare;
      endIndex = cleanText.lastIndexOf(']');
    } else if (firstCurly !== -1) {
      startIndex = firstCurly;
      endIndex = cleanText.lastIndexOf('}');
    }

    if (startIndex === -1 || endIndex === -1) throw new Error("JSON ê´„í˜¸ ì°¾ê¸° ì‹¤íŒ¨");
    const jsonStr = cleanText.substring(startIndex, endIndex + 1);
    return JSON.parse(jsonStr);
  } catch (e: any) {
    throw new Error(`JSON íŒŒì‹± ì˜¤ë¥˜: ${e.message}`);
  }
}

export async function POST(req: Request) {
  try {
    const { url, keyword, groupName, collectionMode } = await req.json();
    
    if (!url) return NextResponse.json({ error: 'URL ì—†ìŒ' }, { status: 400 });

    let targetUrl = url.trim();
    if (targetUrl.includes('](')) {
       const match = targetUrl.match(/\((https?:\/\/[^\)]+)\)/);
       if (match) targetUrl = match[1];
    }

    const supabase = createClient(
      process.env.NEXT_PUBLIC_SUPABASE_URL || "",
      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || ""
    );
    
    const { data: existingUrl } = await supabase
      .from('local_data')
      .select('id')
      .eq('source_url', targetUrl)
      .maybeSingle();

    if (existingUrl) {
      console.log(`âš ï¸ [ì¤‘ë³µ URL] íŒ¨ìŠ¤: ${targetUrl}`);
      return NextResponse.json({ success: true, count: 0, message: "URL Duplicate" });
    }

    console.log(`\n--- ğŸš€ [ê°€ë™] ${targetUrl} (ëª¨ë“œ: ${collectionMode}) ---`);

    const firecrawl = new FirecrawlApp({ apiKey: process.env.FIRECRAWL_API_KEY });
    const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY || "");

    console.log('1ï¸âƒ£ ë°ì´í„° ìˆ˜ì§‘ ì¤‘...');
    
    const scrapeResult = await firecrawl.scrape(targetUrl, { 
      formats: ['markdown']
    }) as any;
    
    const rawMarkdown = scrapeResult.data?.markdown || scrapeResult.markdown;
    
    if (!rawMarkdown || rawMarkdown.length < 50) {
       console.log('âš ï¸ ë³¸ë¬¸ ë‚´ìš© ë¶€ì¡±');
       return NextResponse.json({ success: true, count: 0, data: [] });
    }

    console.log('2ï¸âƒ£ AI ì •ë°€ ë¶„ì„ (ê°•ë¦‰ ì§€ì—­ ê²€ì¦)...');
    let aiText = '';

    for (const modelName of MODEL_CANDIDATES) {
      try {
        const model = genAI.getGenerativeModel({ 
          model: modelName,
          generationConfig: { responseMimeType: "application/json" }
        });

        // [í•µì‹¬] ì§€ì—­ í•œì • í”„ë¡¬í”„íŠ¸ ì¶”ê°€
        const prompt = `
          ë„ˆëŠ” 'ê°•ë¦‰ ë§›ì§‘ ê²€ì¦ê´€'ì´ì•¼.
          ì‚¬ìš©ì íƒ€ê²Ÿ: "${keyword}"
          
          **ğŸš¨ ê²€ì¦ ê°€ì´ë“œë¼ì¸:**
          1. **ì§€ì—­ í™•ì¸ (ê°€ì¥ ì¤‘ìš”):** - ì´ ê°€ê²Œê°€ **'ê°•ë¦‰(Gangneung)'** ì§€ì—­ì— ìˆëŠ” ê³³ì¸ê°€?
             - ë§Œì•½ ì„œìš¸, ë¶€ì‚°, ëŒ€êµ¬ ë“± **íƒ€ ì§€ì—­ì˜ ë™ëª… ì´ì¸ ê°€ê²Œë¼ë©´ ì ˆëŒ€ ìˆ˜ì§‘í•˜ì§€ ë§ˆ (ë¹ˆ ë°°ì—´ [] ë°˜í™˜).**
          
          2. **ë‚´ìš© í™•ì¸:** - íƒ€ê²Ÿ("${keyword}")ì— ëŒ€í•œ ìœ ì˜ë¯¸í•œ ì •ë³´(í›„ê¸°)ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ê°€?
          
          3. **ë‚ ì§œ í•„í„°:** - 2024ë…„ 1ì›” 1ì¼ ì´í›„ ìµœì‹  ì •ë³´ì¸ê°€? (2023ë…„ ì´ì „ ì œì™¸)

          4. **ë°ì´í„° ì •ì œ:**
             - ìƒí˜¸ëª…ì€ íƒ€ê²Ÿ ì´ë¦„("${keyword}")ìœ¼ë¡œ í†µì¼.

          **ë°˜í™˜ í˜•ì‹ (JSON ë°°ì—´):**
          ì¡°ê±´ ë¶ˆë§Œì¡± ì‹œ [] ë°˜í™˜.
          [
            { 
              "title": "${keyword}", 
              "content": "ê°•ë¦‰ì  í•µì‹¬ í›„ê¸° ìš”ì•½", 
              "category": "ë§›ì§‘",
              "image_url": "ì´ë¯¸ì§€ ì£¼ì†Œ"
            }
          ]

          ë°ì´í„°: ${rawMarkdown.slice(0, 30000)}
        `;

        const result = await model.generateContent(prompt);
        aiText = await result.response.text();
        if (aiText) break;
      } catch (e) { continue; }
    }

    if (!aiText) throw new Error('AI ë¶„ì„ ì‹¤íŒ¨');

    let parsedData = extractAndParseJSON(aiText);
    if (!Array.isArray(parsedData)) parsedData = [parsedData];

    if (parsedData.length === 0) {
        console.log(`âš ï¸ í•„í„°ë§ë¨ (ê°•ë¦‰ ì•„ë‹˜/ë‚´ìš© ì—†ìŒ/ì˜›ë‚  ê¸€)`);
        return NextResponse.json({ success: true, count: 0, data: [] });
    }

    const uniqueData = parsedData; 
    
    console.log(`âœ… ${uniqueData.length}ê±´ ê°•ë¦‰ ë°ì´í„° í™•ë³´`);

    const rowsToInsert = uniqueData.map((item: any) => ({
      title: item.title,
      content: item.content,
      category: item.category,
      source_url: targetUrl,
      image_url: item.image_url || null,
      group_name: groupName || null,
      collection_mode: collectionMode || 'net'
    }));

    const { error: dbError } = await supabase.from('local_data').insert(rowsToInsert);
    if (dbError) throw new Error(dbError.message);

    return NextResponse.json({ success: true, count: uniqueData.length, data: uniqueData });

  } catch (error: any) {
    if (error.message.includes('Unrecognized key')) console.error('â— Firecrawl ì˜µì…˜ ì˜¤ë¥˜');
    console.error('â— ì—ëŸ¬:', error.message);
    return NextResponse.json({ success: false, error: error.message }, { status: 500 });
  }
}
</file>

<file path="app/api/diagnosis/route.ts">
import FirecrawlApp from '@mendable/firecrawl-js';
import { GoogleGenerativeAI } from '@google/generative-ai';
import { NextResponse } from 'next/server';

export async function POST(req: Request) {
  try {
    const { storeName, location } = await req.json();
    const query = `${location} ${storeName} í›„ê¸° ë¦¬ë·°`;

    console.log(`\nğŸ¥ [ì§„ë‹¨ ëª¨ë“œ] "${query}" ë¶„ì„ ì‹œì‘...`);

    const apiKey = process.env.FIRECRAWL_API_KEY;
    const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY || "");
    const firecrawl = new FirecrawlApp({ apiKey: apiKey });

    // 1. ê²€ìƒ‰ (ìƒìœ„ 30ê°œë§Œ ë¹ ë¥´ê²Œ í™•ì¸)
    const searchResponse = await firecrawl.search(query, { limit: 30 });
    const searchResults = (searchResponse as any).data || (searchResponse as any).web || [];

    // 2. ê²€ìƒ‰ ê²°ê³¼ ë¶„ì„ (ê°€ê²Œ ì´ë¦„ì´ ì œëª©/ë‚´ìš©ì— ì–¼ë§ˆë‚˜ í¬í•¨ë˜ì—ˆëŠ”ê°€?)
    const mentionCount = searchResults.length;
    
    // 3. AIì—ê²Œ ì„±ì í‘œ ì‘ì„± ìš”ì²­
    // ê²€ìƒ‰ëœ ë°ì´í„°ì˜ ìš”ì•½ë³¸ì„ AIì—ê²Œ ë˜ì ¸ì¤ë‹ˆë‹¤.
    const contextData = JSON.stringify(searchResults.map((item: any) => ({
      title: item.title,
      desc: item.description,
      url: item.url
    })));

    const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash-exp" });
    
    const prompt = `
      ë„ˆëŠ” 'AI ê²€ìƒ‰ ìµœì í™”(GEO) ì»¨ì„¤í„´íŠ¸'ì•¼.
      í´ë¼ì´ì–¸íŠ¸ ê°€ê²Œ ì´ë¦„: "${storeName}" (${location})
      
      ì•„ë˜ëŠ” ê²€ìƒ‰ ì—”ì§„(êµ¬ê¸€/ë¹™)ì—ì„œ ì´ ê°€ê²Œë¥¼ ê²€ìƒ‰í–ˆì„ ë•Œ ë‚˜ì˜¤ëŠ” ìƒìœ„ 30ê°œ ê²°ê³¼ ë°ì´í„°ì•¼.
      ì´ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ëƒ‰ì •í•˜ê²Œ ì§„ë‹¨ ë³´ê³ ì„œë¥¼ ì‘ì„±í•´ì¤˜.

      **ë°ì´í„°:**
      ${contextData}

      **ì‘ì„± ì–‘ì‹ (JSON):**
      {
        "score": 0~100 ì‚¬ì´ ìˆ«ì (ë…¸ì¶œì´ ë§ê³  ì •í™•í• ìˆ˜ë¡ ê³ ë“ì , ê²°ê³¼ê°€ ì—†ìœ¼ë©´ 0ì ),
        "rank_status": "ê²€ìƒ‰ ê²°ê³¼ ${mentionCount}ê±´ ë°œê²¬ë¨ (ìƒìœ„ê¶Œ ë…¸ì¶œ ìƒíƒœ)",
        "summary": "í•œì¤„ ìš”ì•½ (ì˜ˆ: ë„¤ì´ë²„ ë¸”ë¡œê·¸ ë¦¬ë·°ëŠ” ë§ìœ¼ë‚˜ ìµœì‹  ê¸€ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.)",
        "details": [
          "ë¶„ì„ ë‚´ìš© 1 (ì¥ì )",
          "ë¶„ì„ ë‚´ìš© 2 (ë‹¨ì /ë¬¸ì œì )",
          "ë¶„ì„ ë‚´ìš© 3 (AIê°€ ì¸ì‹í•˜ëŠ” ê°€ê²Œ ì´ë¯¸ì§€)"
        ],
        "solution": "êµ¬ì²´ì ì¸ í•´ê²° ë°©ì•ˆ 1ê°€ì§€ (ì˜ˆ: 'ê°•ë¦‰ ë¶•ì–´ë¹µ ë§›ì§‘' í‚¤ì›Œë“œë¡œ ë¸”ë¡œê·¸ 3ê°œ ë°°í¬ ì‹œê¸‰)"
      }
    `;

    const result = await model.generateContent(prompt);
    const responseText = await result.response.text();
    
    // JSON íŒŒì‹±
    let report;
    try {
      const cleanText = responseText.replace(/```json|```/g, "").trim();
      report = JSON.parse(cleanText);
    } catch (e) {
      report = { 
        score: 0, 
        rank_status: "ë¶„ì„ ì‹¤íŒ¨", 
        summary: "AIê°€ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.", 
        details: [], 
        solution: "ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." 
      };
    }

    console.log(`âœ… ì§„ë‹¨ ì™„ë£Œ: ì ìˆ˜ ${report.score}ì `);
    return NextResponse.json({ success: true, report });

  } catch (error: any) {
    console.error(error);
    return NextResponse.json({ success: false, error: error.message }, { status: 500 });
  }
}
</file>

<file path="app/api/search/route.ts">
import FirecrawlApp from '@mendable/firecrawl-js';
import { NextResponse } from 'next/server';

export async function POST(req: Request) {
  try {
    const { keyword, collectionMode } = await req.json();

    let searchKeyword = keyword;
    let limitCount = 40; // ë„‰ë„‰í•˜ê²Œ

    // [í•µì‹¬] ê²€ìƒ‰ì–´ì— 'ê°•ë¦‰' ì§€ì—­ëª… ê°•ì œ ê²°í•©
    // ì‚¬ìš©ìê°€ 'ê°•ë¦‰'ì„ ì•ˆ ì¼ì–´ë„ ìë™ìœ¼ë¡œ ë¶™ì—¬ì¤ë‹ˆë‹¤.
    const regionKeyword = keyword.includes('ê°•ë¦‰') ? keyword : `ê°•ë¦‰ ${keyword}`;

    if (collectionMode === 'store') {
      // 1. ì—…ì²´ ëª¨ë“œ: "ê°•ë¦‰ [ê°€ê²Œëª…] í›„ê¸°" + ë¸”ë¡œê·¸ í•„í„°
      searchKeyword = `${regionKeyword} í›„ê¸° (site:blog.naver.com OR site:tistory.com)`;
      console.log(`\nğŸ¢ [ì—…ì²´ ì •ë°€ íƒìƒ‰] ì§€ì—­ í•œì • ê²€ìƒ‰: ${searchKeyword}`);
    } else {
      // 2. ê·¸ë¬¼ë§ ëª¨ë“œ: "ê°•ë¦‰ [í‚¤ì›Œë“œ] ì¶”ì²œ"
      searchKeyword = `${regionKeyword} ì¶”ì²œ ë¦¬ë·° (site:blog.naver.com OR site:tistory.com)`;
      console.log(`\nğŸ•¸ï¸ [ê·¸ë¬¼ë§ íƒìƒ‰] ì§€ì—­ í•œì • ê²€ìƒ‰: ${searchKeyword}`);
    }

    const apiKey = process.env.FIRECRAWL_API_KEY;
    if (!apiKey) return NextResponse.json({ success: false, error: "API í‚¤ ì—†ìŒ" }, { status: 500 });

    const firecrawl = new FirecrawlApp({ apiKey: apiKey });
    
    const searchResponse = await firecrawl.search(searchKeyword, {
      limit: limitCount
    });

    const searchResults = (searchResponse as any).data || (searchResponse as any).web || [];

    if (!searchResults || searchResults.length === 0) {
      console.log("âš ï¸ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");
      return NextResponse.json({ success: true, urls: [] });
    }

    let filteredUrls = searchResults
      .map((item: any) => item.url)
      .filter((url: string) => {
        return url && (url.includes('blog.naver.com') || url.includes('tistory.com'));
      });

    filteredUrls = [...new Set(filteredUrls)];
    
    console.log(`âœ… 'ê°•ë¦‰' ê´€ë ¨ URL ${filteredUrls.length}ê°œ í™•ë³´`);
    
    return NextResponse.json({ success: true, urls: filteredUrls });

  } catch (error: any) {
    return NextResponse.json({ success: false, error: error.message }, { status: 500 });
  }
}
</file>

<file path="app/api/trend/route.ts">
import FirecrawlApp from '@mendable/firecrawl-js';
import { GoogleGenerativeAI } from '@google/generative-ai';
import { NextResponse } from 'next/server';

export async function POST(req: Request) {
  try {
    // keyword: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë³´ë‚´ì¤€ 'ê°€ê²Œ ì´ë¦„' ë˜ëŠ” 'ì¹´í…Œê³ ë¦¬'
    const { keyword, location } = await req.json(); 

    const today = new Date();
    const monthStr = `${today.getFullYear()}ë…„ ${today.getMonth() + 1}ì›”`;
    
    // ê²€ìƒ‰ì–´ëŠ” ë„“ê²Œ ì¡ì•„ì„œ íŠ¸ë Œë“œë¥¼ íŒŒì•…í•©ë‹ˆë‹¤.
    const searchQuery = `${monthStr} ${location} ì—¬í–‰ ë§›ì§‘ í•«í”Œ íŠ¸ë Œë“œ`;

    console.log(`\nğŸ“ˆ [íŠ¸ë Œë“œ í—Œí„°] ì£¼ì œ: "${keyword}" / ê²€ìƒ‰ì–´: "${searchQuery}"`);

    const apiKey = process.env.FIRECRAWL_API_KEY;
    const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY || "");
    const firecrawl = new FirecrawlApp({ apiKey: apiKey });

    // 1. ì‹¤ì‹œê°„ íŠ¸ë Œë“œ ê²€ìƒ‰
    const searchResponse = await firecrawl.search(searchQuery, { limit: 10 });
    const searchResults = (searchResponse as any).data || (searchResponse as any).web || [];
    
    const trendContext = searchResults.map((r: any) => r.title).join("\n");

    // 2. AI ê¸°íš íšŒì˜
    const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash-exp" });
    
    // [ìˆ˜ì • í¬ì¸íŠ¸] 'ë¶•ì–´ë¹µ' -> '${keyword}' ë³€ìˆ˜ë¡œ ë³€ê²½
    const prompt = `
      ë„ˆëŠ” 'ë°”ì´ëŸ´ ë§ˆì¼€íŒ… ê¸°íšì'ì•¼.
      ì§€ê¸ˆ ì‹œì (${monthStr})ì˜ íŠ¸ë Œë“œ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ, **'${keyword}'** ê°€ê²Œë¥¼ í™ë³´í•  **ê°€ì¥ íš¨ê³¼ì ì¸ ë¸”ë¡œê·¸ ì»¨ì…‰ 3ê°€ì§€**ë¥¼ ê¸°íší•´ì¤˜.

      **[ì‹¤ì‹œê°„ íŠ¸ë Œë“œ ë°ì´í„°]**
      ${trendContext}

      **[ê¸°íš ì¡°ê±´]**
      1. **ì‹œì˜ì„±:** í˜„ì¬ ê³„ì ˆ(ë‚ ì”¨), ì›”ë³„ í–‰ì‚¬, ìµœì‹  ìœ í–‰ì„ ë°˜ë“œì‹œ ë°˜ì˜í•  ê²ƒ.
      2. **ì—°ê´€ì„±:** íŠ¸ë Œë“œì™€ **'${keyword}'(ê°€ê²Œ/ë©”ë‰´)**ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°í•  ê²ƒ. (ì–µì§€ìŠ¤ëŸ¬ìš´ ì—°ê²° ì§€ì–‘)
      3. **ë‹¤ì–‘ì„±:** 3ê°€ì§€ ì»¨ì…‰ì´ ì„œë¡œ ê²¹ì¹˜ì§€ ì•Šê²Œ íƒ€ê²Ÿì„ ë‹¤ë¥´ê²Œ ì„¤ì •í•  ê²ƒ.

      **[ì¶œë ¥ í˜•ì‹ (JSON Only)]**
      {
        "concepts": [
          {
            "type": "unique_id_1",
            "title": "ì»¨ì…‰ ì´ë¦„ (ì˜ˆ: ğŸ¥¶ í•œíŒŒì—” ì–¼í°í•œ ì§¬ë½• êµ­ë¬¼)",
            "description": "ê¸°íš ì˜ë„ ë° íƒ€ê²Ÿ ì„¤ëª… (ì˜ˆ: ì˜í•˜ ë‚ ì”¨ ê°•ì¡°, í•´ì¥ í•„ìš”í•œ ì§ì¥ì¸ íƒ€ê²Ÿ)",
            "keywords": ["ê°•ë¦‰í•œíŒŒ", "ê²¨ìš¸ë³„ë¯¸", "${keyword}"]
          },
          ... (3ê°œ)
        ]
      }
    `;

    const result = await model.generateContent(prompt);
    const text = await result.response.text();
    
    const cleanText = text.replace(/```json|```/g, "").trim();
    const data = JSON.parse(cleanText);

    console.log(`âœ… íŠ¸ë Œë“œ ë¶„ì„ ì™„ë£Œ: ${data.concepts.length}ê°œ ì»¨ì…‰ ë„ì¶œ`);
    return NextResponse.json({ success: true, concepts: data.concepts });

  } catch (error: any) {
    console.error(error);
    return NextResponse.json({ success: false, error: error.message }, { status: 500 });
  }
}
</file>

<file path="test-firecrawl.mjs">
import FirecrawlApp from '@mendable/firecrawl-js';
import dotenv from 'dotenv';

dotenv.config({ path: '.env.local' });

const app = new FirecrawlApp({ apiKey: process.env.FIRECRAWL_API_KEY });

async function runTest() {
  console.log("ğŸš€ [ê°•ë¦‰ AI ë°ì´í„° ëŒ] ìˆ˜ì§‘ ì—”ì§„ ê°€ë™...");
  const targetUrl = 'https://www.gn.go.kr';

  try {
    const result = await app.scrape(targetUrl, { formats: ['markdown'] });

    // [ìˆ˜ì •] result.success ëŒ€ì‹  ì‹¤ì œ ë°ì´í„°(markdown)ê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
    const markdownContent = result.data?.markdown || result.markdown;

    if (markdownContent) {
      console.log("âœ… ìˆ˜ì§‘ ì„±ê³µ! (ê°•ë¦‰ì‹œì²­ ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤)");
      console.log("ğŸ“ ìˆ˜ì§‘ëœ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°:");
      console.log("--------------------------------------------------");
      console.log(markdownContent.slice(0, 500) + "...");
      console.log("--------------------------------------------------");
      console.log(`ğŸ“Š ì‚¬ìš©ëœ í¬ë ˆë”§: ${result.metadata?.creditsUsed || 1}`);
    } else {
      console.error("âŒ ìˆ˜ì§‘ ì‹¤íŒ¨: ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      console.log("ì‘ë‹µ êµ¬ì¡°:", JSON.stringify(result, null, 2));
    }
  } catch (error) {
    console.error("âŒ ì‹œìŠ¤í…œ ì—ëŸ¬:", error.message);
  }
}

runTest();
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="app/[store_id]/blog/page.tsx">
import { createClient } from '@supabase/supabase-js';

export const dynamic = 'force-dynamic';

export default async function BlogListPage({ params }: { params: Promise<{ store_id: string }> }) {
  const { store_id } = await params;
  
  const supabase = createClient(
    "https://lmbiklnpcaltrkarqhmg.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtYmlrbG5wY2FsdHJrYXJxaG1nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczMjk5MDMsImV4cCI6MjA4MjkwNTkwM30.QyVa1fjB-JyGhcvv4OPpvaziICOOO6_Fey4fPJKvugc"
  );

  const { data: posts } = await supabase
    .from('blog_posts')
    .select('*')
    .eq('store_id', store_id)
    .order('created_at', { ascending: false });

  return (
    <main className="min-h-screen bg-white text-black p-6 font-sans">
      <div className="max-w-3xl mx-auto">
        <h1 className="text-3xl font-black mb-8 border-b pb-4">ğŸ“ {store_id} ê³µì‹ ë¸”ë¡œê·¸</h1>
        
        {posts && posts.length > 0 ? (
          <div className="space-y-16">
            {posts.map((post) => (
              <article key={post.id} className="bg-slate-50 p-8 rounded-3xl border border-slate-100 shadow-sm">
                
                <div className="flex items-center gap-2 mb-6">
                   <span className="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold">New</span>
                   <span className="text-slate-400 text-sm">{new Date(post.created_at).toLocaleDateString()}</span>
                </div>

                <h2 className="text-2xl font-bold mb-6 text-slate-900 leading-tight">{post.title}</h2>

                {/* ğŸ“¸ ì—¬ê¸°ê°€ í•µì‹¬! ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ë¬´ì¡°ê±´ ì¶œë ¥ */}
                {post.images && post.images.length > 0 ? (
                  <div className="flex gap-4 overflow-x-auto pb-4 mb-8">
                    {post.images.map((imgStr: string, idx: number) => (
                      <img 
                        key={idx} 
                        src={imgStr} 
                        alt={`Blog image ${idx}`} 
                        className="h-64 rounded-2xl shadow-md object-cover flex-shrink-0"
                      />
                    ))}
                  </div>
                ) : (
                  // ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´ ë””ë²„ê¹…ìš© ë©”ì‹œì§€ (ë‚˜ì¤‘ì— ì§€ìš°ì…”ë„ ë¨)
                  <p className="text-xs text-red-300 mb-4 hidden">*ì´ë¯¸ì§€ ë°ì´í„° ì—†ìŒ</p>
                )}

                <div className="prose prose-slate max-w-none text-slate-700 leading-loose whitespace-pre-wrap">
                  {post.content}
                </div>

                <div className="mt-8 pt-6 border-t border-slate-200 flex gap-2 flex-wrap">
                  {Array.isArray(post.keywords) && post.keywords.map((k: string, i: number) => (
                    <span key={i} className="text-xs text-slate-500 bg-white border px-2 py-1 rounded-lg">#{k}</span>
                  ))}
                </div>
              </article>
            ))}
          </div>
        ) : (
          <div className="text-center py-20 bg-slate-50 text-slate-400">ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>
        )}
      </div>
    </main>
  );
}
</file>

<file path="app/[store_id]/page.tsx">
import { createClient } from '@supabase/supabase-js';

export const dynamic = 'force-dynamic';
export const revalidate = 0;

export default async function StorePage({ params }: { params: Promise<{ store_id: string }> }) {
  const { store_id } = await params; 
  
  const supabase = createClient(
    "https://lmbiklnpcaltrkarqhmg.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtYmlrbG5wY2FsdHJrYXJxaG1nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczMjk5MDMsImV4cCI6MjA4MjkwNTkwM30.QyVa1fjB-JyGhcvv4OPpvaziICOOO6_Fey4fPJKvugc"
  );

  const { data: news } = await supabase
    .from('gangneung_stores')
    .select('*')
    .eq('store_id', store_id)
    .order('created_at', { ascending: false }) // ë‚ ì§œìˆœ ì •ë ¬
    .limit(1)
    .maybeSingle();

  if (!news) return <div className="p-20 text-center text-slate-300 font-bold tracking-widest uppercase">Preparing {store_id} News...</div>;

  return (
    <main className="min-h-screen bg-white text-black py-24 px-6 font-sans">
      <script type="application/ld+json" dangerouslySetInnerHTML={{ __html: JSON.stringify(news.ai_structured_data) }} />
      <div className="max-w-2xl mx-auto text-center space-y-12">
        <h1 className="text-6xl font-black tracking-tighter text-slate-900 drop-shadow-sm">{news.store_name}</h1>
        <div className="py-24 px-12 bg-slate-50 rounded-[60px] border border-slate-100 shadow-inner">
          <p className="text-blue-600 font-black text-[10px] uppercase tracking-[0.3em] mb-8">Latest AI Update</p>
          <h2 className="text-4xl font-bold leading-tight break-keep text-slate-800">"{news.raw_info}"</h2>
          <p className="text-slate-400 text-xs mt-12 font-medium italic opacity-70">
            Updated at: {new Date(news.created_at).toLocaleString('ko-KR')}
          </p>
        </div>
        <p className="text-[10px] font-black text-slate-300 uppercase tracking-[0.5em] pt-10">
          Powered by GANGNEUNG AIO Platform Service
        </p>
      </div>
    </main>
  );
}
</file>

<file path="app/admin/[store_id]/page.tsx">
'use client';
import { useState, use, useRef } from 'react';
import { analyzeAndSave, generateMonthlyReport, createBlogPost } from '../actions';

export default function AdminPage({ params }: { params: Promise<{ store_id: string }> }) {
  const resolvedParams = use(params);
  const store_id = resolvedParams.store_id;

  const [info, setInfo] = useState('');
  const [blogTopic, setBlogTopic] = useState('');
  const [selectedImages, setSelectedImages] = useState<string[]>([]); 
  const [loading, setLoading] = useState(false);
  const [reportLoading, setReportLoading] = useState(false);
  const [blogLoading, setBlogLoading] = useState(false);
  const [report, setReport] = useState<string | null>(null);
  const fileInputRef = useRef<HTMLInputElement>(null);

  // âš¡ï¸ [í•µì‹¬] ì´ë¯¸ì§€ ì´ˆê³ ì† ì••ì¶• í•¨ìˆ˜ (ìš©ëŸ‰ 1/10ë¡œ ì¤„ì´ê¸°)
  const compressImage = (file: File): Promise<string> => {
    return new Promise((resolve) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = (event) => {
        const img = new Image();
        img.src = event.target?.result as string;
        img.onload = () => {
          const canvas = document.createElement('canvas');
          const MAX_WIDTH = 800; // ê°€ë¡œ ìµœëŒ€ 800pxë¡œ ì œí•œ (ì¶©ë¶„í•¨)
          const scaleSize = MAX_WIDTH / img.width;
          canvas.width = MAX_WIDTH;
          canvas.height = img.height * scaleSize;

          const ctx = canvas.getContext('2d');
          ctx?.drawImage(img, 0, 0, canvas.width, canvas.height);
          
          // JPEG í¬ë§·, í’ˆì§ˆ 0.6 (60%)ìœ¼ë¡œ ì••ì¶• -> ìš©ëŸ‰ í™• ì¤„ì–´ë“¦
          resolve(canvas.toDataURL('image/jpeg', 0.6)); 
        };
      };
    });
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    const res = await analyzeAndSave(info, store_id);
    setLoading(false);
    if (res.success) { alert("âœ… ì„±ê³µ! ë°ì´í„°ê°€ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤."); setInfo(''); }
    else alert("âŒ ì‹¤íŒ¨: " + res.message);
  };

  const handleGetReport = async () => {
    setReportLoading(true);
    const res = await generateMonthlyReport(store_id);
    setReportLoading(false);
    if (res.success) setReport(res.report!);
  };

  // ğŸ“¸ ë‹¤ì¤‘ ì´ë¯¸ì§€ ì„ íƒ ì²˜ë¦¬ (ì••ì¶• ì ìš©)
  const handleImageChange = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const files = e.target.files;
    if (files && files.length > 0) {
      // ë¡œë”© í‘œì‹œ ê°™ì€ê²Œ ì—†ìœ¼ë‹ˆ ì¼ë‹¨ ë©ˆì¶¤ ëŠë‚Œì´ ë‚  ìˆ˜ ìˆì–´ì„œ ë¡œê·¸ ì°ìŒ
      console.log("ì´ë¯¸ì§€ ì••ì¶• ì‹œì‘..."); 
      
      const compressedImages: string[] = [];
      
      // ëª¨ë“  íŒŒì¼ì„ ì••ì¶•í•´ì„œ ë°°ì—´ì— ë‹´ìŒ
      for (let i = 0; i < files.length; i++) {
        const compressed = await compressImage(files[i]);
        compressedImages.push(compressed);
      }

      // ìƒíƒœ ì—…ë°ì´íŠ¸
      setSelectedImages(prev => [...prev, ...compressedImages].slice(0, 10));
    }
  };
  
  const clearImages = () => {
    setSelectedImages([]);
    if (fileInputRef.current) fileInputRef.current.value = '';
  };

  const handleCreateBlog = async () => {
    const imgCount = selectedImages.length;
    if (!confirm(`AI ì‘ê°€ì—ê²Œ ${imgCount > 0 ? imgCount + 'ì¥ì˜ ì‚¬ì§„ê³¼ í•¨ê»˜' : ''} ê¸€ì“°ê¸°ë¥¼ ì‹œí‚¤ê² ìŠµë‹ˆê¹Œ?\n(AI ë¶„ì„ì—ëŠ” ì•½ 10~15ì´ˆê°€ ì†Œìš”ë©ë‹ˆë‹¤)`)) return;
    
    setBlogLoading(true);
    
    // ì••ì¶•ëœ ì´ë¯¸ì§€ë¥¼ ì „ì†¡í•˜ë¯€ë¡œ í›¨ì”¬ ë¹ ë¦„
    const res = await createBlogPost(store_id, blogTopic, selectedImages.length > 0 ? selectedImages : undefined);
    
    setBlogLoading(false);
    
    if (res.success) {
      alert(`ğŸ‰ ë¸”ë¡œê·¸ ë°œí–‰ ì™„ë£Œ!\n\nì œëª©: ${res.title}\n\n[ë¸”ë¡œê·¸ ê²Œì‹œíŒ]ì—ì„œ í™•ì¸í•´ë³´ì„¸ìš”.`);
      setBlogTopic('');
      clearImages(); 
    } else {
      alert("âŒ ì‹¤íŒ¨: " + res.message);
    }
  };

  return (
    <div className="min-h-screen bg-slate-100 py-10 px-4 font-sans text-slate-800">
      <div className="max-w-2xl mx-auto space-y-8">
        
         <div className="bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
          <h1 className="text-xl font-extrabold mb-4 text-slate-800">ADMIN <span className="text-blue-600">#{store_id}</span></h1>
          <form onSubmit={handleSubmit} className="space-y-4">
            <textarea
              value={info} onChange={(e) => setInfo(e.target.value)}
              className="w-full h-24 p-4 bg-slate-50 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 resize-none"
              placeholder="ì˜¤ëŠ˜ì˜ ì†Œì‹ (ì˜ˆ: ëŒ€ë°©ì–´ ì…ê³ )"
            />
            <button disabled={loading} className="w-full py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 disabled:bg-slate-300">
              {loading ? 'AI ì²˜ë¦¬ ì¤‘...' : 'ì‹¤ì‹œê°„ ë°˜ì˜'}
            </button>
          </form>
        </div>

        <div className="bg-gradient-to-br from-purple-600 to-indigo-700 p-8 rounded-3xl shadow-lg text-white">
          <h2 className="text-lg font-bold mb-2 flex items-center gap-2">
            ğŸ“¸ AI ë¸”ë¡œê·¸ ì‘ê°€ <span className="bg-white/20 text-[10px] px-2 py-0.5 rounded-full uppercase">Speed-Vision</span>
          </h2>
          <p className="text-purple-100 text-sm mb-6 opacity-90">
            ì‚¬ì§„ì„ ì—¬ëŸ¬ ì¥ ì„ íƒí•´ì£¼ì„¸ìš”. (ìë™ ì••ì¶• ì „ì†¡)
          </p>

          <div className="space-y-4">
            <input 
              type="text" 
              value={blogTopic} onChange={(e) => setBlogTopic(e.target.value)}
              className="w-full p-4 rounded-xl text-black outline-none border-none shadow-inner"
              placeholder="ê¸€ ì£¼ì œ (ì˜ˆ: íšŒì‹ ë©”ë‰´ í’€ì½”ìŠ¤)"
            />
            
            <div className="flex gap-2">
              <input 
                type="file" 
                accept="image/*" 
                multiple 
                ref={fileInputRef} 
                onChange={handleImageChange} 
                className="hidden" 
              />
              
              <button 
                onClick={() => fileInputRef.current?.click()}
                className={`px-4 py-4 rounded-xl font-bold transition-all border border-white/30 ${selectedImages.length > 0 ? 'bg-green-500 text-white border-none' : 'bg-white/20 hover:bg-white/30'}`}
              >
                {selectedImages.length > 0 ? `âœ… ${selectedImages.length}ì¥` : "ğŸ“¸ ì‚¬ì§„ ì¶”ê°€"}
              </button>
              
               {selectedImages.length > 0 && (
                  <button onClick={clearImages} className="px-3 py-4 bg-red-500/80 text-white rounded-xl font-bold hover:bg-red-500">
                    ì‚­ì œ
                  </button>
                )}

              <button 
                onClick={handleCreateBlog} disabled={blogLoading}
                className="flex-1 px-6 py-4 bg-white text-purple-700 rounded-xl font-black hover:bg-gray-100 disabled:bg-gray-300 transition-all shadow-lg"
              >
                {blogLoading ? `ë¶„ì„ ì¤‘...` : 'ê¸€ì“°ê¸° ğŸš€'}
              </button>
            </div>

            {selectedImages.length > 0 && (
              <div className="mt-4 flex gap-2 overflow-x-auto pb-2 animate-fade-in">
                {selectedImages.map((imgSrc, index) => (
                  <img key={index} src={imgSrc} alt={`Preview ${index}`} className="h-24 w-24 rounded-xl object-cover border-2 border-white/50 shadow-md shrink-0" />
                ))}
              </div>
            )}
          </div>
        </div>

        <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
          <div className="bg-slate-800 p-5 flex justify-between items-center text-white">
            <span className="font-bold text-sm">ì›”ê°„ ë§ˆì¼€íŒ… ì§„ë‹¨ì„œ</span>
            <button onClick={handleGetReport} disabled={reportLoading} className="bg-white text-black px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-gray-200">
              {reportLoading ? 'ë¶„ì„ ì¤‘...' : 'ë°œê¸‰ ë°›ê¸°'}
            </button>
          </div>
          {report && <div className="p-8 whitespace-pre-wrap text-sm text-slate-700 leading-relaxed">{report}</div>}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="app/admin/actions.ts">
'use server';

import { GoogleGenAI } from '@google/genai';
import { createClient } from '@supabase/supabase-js';

const SUPABASE_URL = "https://lmbiklnpcaltrkarqhmg.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtYmlrbG5wY2FsdHJrYXJxaG1nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczMjk5MDMsImV4cCI6MjA4MjkwNTkwM30.QyVa1fjB-JyGhcvv4OPpvaziICOOO6_Fey4fPJKvugc"; 
const GEMINI_KEY = process.env.GEMINI_API_KEY;

// í—¬í¼ í•¨ìˆ˜
function getSafeText(response: any): string {
  try {
    if (response?.candidates?.[0]?.content?.parts?.[0]?.text) {
      return response.candidates[0].content.parts[0].text;
    }
    if (typeof response.text === 'function') {
      return response.text();
    }
    return "";
  } catch (e) {
    console.error("ë°ì´í„° ì¶”ì¶œ ì‹¤íŒ¨:", e);
    return "";
  }
}

// 1. ì†Œì‹ ì €ì¥ (ê¸°ì¡´ ìœ ì§€)
export async function analyzeAndSave(info: string, storeId: string) {
  try {
    const client = new GoogleGenAI({ apiKey: GEMINI_KEY! });
    const response = await client.models.generateContent({
      model: "gemini-2.0-flash",
      contents: [{ role: 'user', parts: [{ text: `ê°•ë¦‰ ë§¤ì¥ ì†Œì‹: "${info}" ë‚´ìš©ì„ êµ¬ê¸€ ê²€ìƒ‰ìš© JSON-LD(NewsArticle)ë¡œ ë³€í™˜í•´. JSON ì½”ë“œë§Œ ì¶œë ¥í•´.` }] }]
    });

    let aiJson = getSafeText(response);
    aiJson = aiJson.replace(/```json|```/g, "").trim();

    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
    const { error } = await supabase.from('gangneung_stores').insert([{ 
      store_id: storeId,
      store_name: storeId === 'youngjin' ? 'ì˜ì§„íšŸì§‘' : (storeId === 'gangneung-bap' ? 'ê°•ë¦‰ë°¥ì§‘' : storeId),
      raw_info: info,
      ai_structured_data: JSON.parse(aiJson) 
    }]);

    if (error) throw error;
    return { success: true };
  } catch (error: any) {
    return { success: false, message: error.message };
  }
}

// 2. ë¦¬í¬íŠ¸ (ê¸°ì¡´ ìœ ì§€)
export async function generateMonthlyReport(storeId: string) {
  try {
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
    const firstDay = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString();
    const { data } = await supabase.from('gangneung_stores')
      .select('raw_info').eq('store_id', storeId).gte('created_at', firstDay);

    const count = data?.length || 0;
    const contents = data?.map(d => d.raw_info).join(' | ');
    const client = new GoogleGenAI({ apiKey: GEMINI_KEY! });
    
    const prompt = `
      ë‹¹ì‹ ì€ ëƒ‰ì² í•œ 'ìˆ˜ì„ ë§ˆì¼€íŒ… ë°ì´í„° ë¶„ì„ê°€'ì…ë‹ˆë‹¤.
      í´ë¼ì´ì–¸íŠ¸(${storeId}) ë¦¬í¬íŠ¸ ì‘ì„±.
      ê¸°ê°„: ì´ë²ˆ ë‹¬, AI í™œë™ëŸ‰: ${count}íšŒ, ë‚´ìš©: ${contents}.
      ì–‘ì‹: 1.ì¢…í•©ë“±ê¸‰ 2.ë°ì´í„°ë¶„ì„ 3.í‚¤ì›Œë“œë¶„ì„ 4.ì „ëµ
    `;

    const response = await client.models.generateContent({
      model: "gemini-2.0-flash",
      contents: [{ role: 'user', parts: [{ text: prompt }] }]
    });

    return { success: true, report: getSafeText(response) };
  } catch (error: any) {
    return { success: false, message: error.message };
  }
}

// ğŸ”¥ 3. [ì—„ê²© ìˆ˜ì •] AI ë¸”ë¡œê·¸ ìƒì„± (í™˜ê° ë°©ì§€ + ì´ë¯¸ì§€ ì €ì¥)
export async function createBlogPost(storeId: string, topic?: string, imagesBase64?: string[]) {
  try {
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
    const { data: store } = await supabase
      .from('gangneung_stores')
      .select('store_name, raw_info')
      .eq('store_id', storeId)
      .limit(3);

    const storeName = store?.[0]?.store_name || storeId;
    const recentNews = store?.map(s => s.raw_info).join(', ') || "ê¸°ë³¸ ë©”ë‰´";
    const targetTopic = topic || "ê°•ë¦‰ ë§›ì§‘ ì¶”ì²œ";

    const client = new GoogleGenAI({ apiKey: GEMINI_KEY! });
    
    // ğŸ›‘ [í•µì‹¬] í—›ì†Œë¦¬ ë°©ì§€ìš© ì´ˆê°•ë ¥ í”„ë¡¬í”„íŠ¸
    let promptText = `
      ë‹¹ì‹ ì€ 'ê°•ë¦‰ ë¡œì»¬ ì—¬í–‰ ì—ë””í„°'ì…ë‹ˆë‹¤.
      ì²¨ë¶€ëœ ì‚¬ì§„ë“¤ê³¼ ì•„ë˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë¸”ë¡œê·¸ ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”.

      [ğŸš« ì ˆëŒ€ ê¸ˆì§€ ì‚¬í•­ - ì–´ê¸°ë©´ ì‹œìŠ¤í…œ ì˜¤ë¥˜ ë°œìƒ]
      1. **ì—†ëŠ” ë©”ë‰´ ì°½ì¡° ê¸ˆì§€:** ì…ë ¥ëœ ì •ë³´ì— ì—†ëŠ” ë©”ë‰´(íŠ¹íˆ ì°¸ì¹˜, ëìŠ¤í„° ë“±)ëŠ” ì ˆëŒ€ ì–¸ê¸‰í•˜ì§€ ë§ˆì‹œì˜¤. ëª¨ë¥´ë©´ "ì œì²  íšŒ"ë¼ê³ ë§Œ ì“°ì‹œì˜¤.
      2. **ë°°ê²½ ì‚¬ë¬¼ ë¬´ì‹œ:** ì‚¬ì§„ ë°°ê²½ì— ìˆëŠ” ì‹ ë°œ(í¬ë¡ìŠ¤), ì“°ë ˆê¸°í†µ, í–‰ì¸ ë“±ì€ ì ˆëŒ€ ë¬˜ì‚¬í•˜ì§€ ë§ˆì‹œì˜¤. ì˜¤ì§ 'ìŒì‹'ê³¼ 'ë§¤ì¥ ë¶„ìœ„ê¸°'ë§Œ ë³´ì‹œì˜¤.
      3. **íŒë§¤ ì •ë³´ ì™œê³¡ ê¸ˆì§€:** ì‹ ë°œì„ íŒë‹¤ê±°ë‚˜ í•˜ëŠ” ì—‰ëš±í•œ ì†Œë¦¬ëŠ” ì ˆëŒ€ ê¸ˆì§€.

      [âœ… ì‘ì„± ì§€ì¹¨]
      - ì£¼ì œ: ${targetTopic}
      - ë§¤ì¥ëª…: ${storeName}
      - ì‹¤ì œ ì†Œì‹: ${recentNews}
      - ì‚¬ì§„ í™œìš©: ì‚¬ì§„ ì† ìŒì‹ì˜ ìœ¤ê¸°, ìƒ‰ê°, ì‹ ì„ í•¨ë§Œ ë¬˜ì‚¬í•  ê²ƒ.

      [ì¶œë ¥ í˜•ì‹]
      JSON Only: { "title": "ì œëª©", "content": "ë³¸ë¬¸(Markdown)", "keywords": ["í‚¤ì›Œë“œ"] }
    `;

    const requestParts: any[] = [{ text: promptText }];
    if (imagesBase64 && imagesBase64.length > 0) {
        imagesBase64.forEach((imgBase64) => {
            const cleanBase64 = imgBase64.split(',')[1];
            requestParts.push({ inlineData: { mimeType: 'image/jpeg', data: cleanBase64 } });
        });
    }

    const response = await client.models.generateContent({
      model: "gemini-2.0-flash",
      contents: [{ role: 'user', parts: requestParts }]
    });

    let aiJson = getSafeText(response);
    aiJson = aiJson.replace(/```json|```/g, "").trim();
    const blogData = JSON.parse(aiJson);

    // âœ… [ì €ì¥] ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ DBì— í™•ì‹¤í•˜ê²Œ ì €ì¥
    const { error } = await supabase.from('blog_posts').insert([{
      store_id: storeId,
      title: blogData.title,
      content: blogData.content,
      keywords: blogData.keywords,
      images: imagesBase64, // ì—¬ê¸°ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì‚¬ì§„ì´ ì•ˆ ë‚˜ì˜µë‹ˆë‹¤.
      status: 'draft'
    }]);

    if (error) throw error;
    return { success: true, title: blogData.title };

  } catch (error: any) {
    console.error("ë¸”ë¡œê·¸ ìƒì„± ì—ëŸ¬:", error);
    return { success: false, message: error.message };
  }
}
</file>

<file path="app/globals.css">
@import "tailwindcss";

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
}
</file>

<file path="app/llms.txt/route.ts">
// app/llms.txt/route.ts
import { createClient } from '@supabase/supabase-js';
import { NextResponse } from 'next/server';

export async function GET() {
  const supabase = createClient(
    "https://lmbiklnpcaltrkarqhmg.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtYmlrbG5wY2FsdHJrYXJxaG1nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczMjk5MDMsImV4cCI6MjA4MjkwNTkwM30.QyVa1fjB-JyGhcvv4OPpvaziICOOO6_Fey4fPJKvugc"
  );

  // í˜„ì¬ ê¸ˆê³ ì— ìŒ“ì¸ ëª¨ë“  ë§¤ì¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  const { data: stores } = await supabase.from('gangneung_stores').select('store_id, store_name, raw_info');

  // AI í¬ë¡¤ëŸ¬ì—ê²Œ ë³´ì—¬ì¤„ í…ìŠ¤íŠ¸ êµ¬ì„±
  let content = "# Gangneung AIO Data Hub\n\n";
  content += "## Information for LLMs\n";
  content += "This site provides structured real-time data for local businesses in Gangneung.\n\n";
  
  content += "## Registered Stores\n";
  stores?.forEach(store => {
    content += `- ${store.store_name} (ID: ${store.store_id}): ${store.raw_info}\n`;
    content += `  URL: https://ì‚¬ì¥ë‹˜ì˜-ì£¼ì†Œ.vercel.app/${store.store_id}\n`;
  });

  return new NextResponse(content, {
    headers: { 'Content-Type': 'text/plain' },
  });
}
</file>

<file path="app/sitemap.ts">
import { MetadataRoute } from 'next'

export default function sitemap(): MetadataRoute.Sitemap {
  const baseUrl = 'https://gangneung-aio.vercel.app'

  // í˜„ì¬ëŠ” ë©”ì¸ í˜ì´ì§€ë§Œ ìˆì§€ë§Œ, í–¥í›„ Phase 2ì—ì„œ ë°ì´í„°ê°€ ìŒ“ì´ë©´ 
  // ì´ê³³ì— ìë™ìœ¼ë¡œ ëª¨ë“  ê°€ê²Œ í˜ì´ì§€ê°€ ì¶”ê°€ë˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.
  return [
    {
      url: baseUrl,
      lastModified: new Date(),
      changeFrequency: 'daily', // ë§¤ì¼ ì—…ë°ì´íŠ¸ë¨ì„ ë¡œë´‡ì—ê²Œ ì•Œë¦¼
      priority: 1, // ê°€ì¥ ì¤‘ìš”í•œ í˜ì´ì§€(ë©”ì¸)ì„ì„ í‘œì‹œ
    },
    // ì˜ˆì‹œ: í–¥í›„ ì¶”ê°€ë  í˜ì´ì§€ (ë‚˜ì¤‘ì— ìë™ìœ¼ë¡œ ëŠ˜ì–´ë‚˜ê²Œ ë©ë‹ˆë‹¤)
    // {
    //   url: `${baseUrl}/blog`,
    //   lastModified: new Date(),
    //   changeFrequency: 'weekly',
    //   priority: 0.8,
    // },
  ]
}
</file>

<file path="eslint.config.mjs">
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
</file>

<file path="next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;
</file>

<file path="postcss.config.mjs">
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;
</file>

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}
</file>

<file path="package.json">
{
  "name": "gangneung-aio",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@google/genai": "^1.34.0",
    "@google/generative-ai": "^0.24.1",
    "@mendable/firecrawl-js": "^4.10.0",
    "@supabase/supabase-js": "^2.89.0",
    "dotenv": "^17.2.3",
    "has-flag": "^5.0.1",
    "next": "16.1.1",
    "react": "19.2.3",
    "react-dom": "19.2.3",
    "supports-color": "^10.2.2"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "16.1.1",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}
</file>

<file path="app/page.tsx">
"use client";
import { useState, useEffect } from "react";
import { createClient } from "@supabase/supabase-js";

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
);

const ITEMS_PER_PAGE = 24;
type TabType = 'all' | 'store' | 'net' | 'sniper' | 'diagnosis';

export default function Home() {
  const [activeTab, setActiveTab] = useState<TabType>('all');
  const [inputValue, setInputValue] = useState(""); 
  const [isLoading, setIsLoading] = useState(false);
  const [logs, setLogs] = useState<string[]>([]);
  
  const [allData, setAllData] = useState<any[]>([]);
  const [displayData, setDisplayData] = useState<any[]>([]);
  const [currentPage, setCurrentPage] = useState(1);
  const [selectedIds, setSelectedIds] = useState<number[]>([]);
  
  const [groups, setGroups] = useState<string[]>([]);
  const [activeGroup, setActiveGroup] = useState<string | null>(null);

  const [isBlogLoading, setIsBlogLoading] = useState(false); 
  const [isTrendLoading, setIsTrendLoading] = useState(false); 
  const [blogPost, setBlogPost] = useState("");
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [selectedItem, setSelectedItem] = useState<any>(null);
  const [trendConcepts, setTrendConcepts] = useState<any[]>([]);
  const [selectedConcept, setSelectedConcept] = useState<any>(null);
  const [report, setReport] = useState<any>(null);

  useEffect(() => { fetchData(); }, []);

  useEffect(() => {
    let filtered = allData;
    if (activeTab === 'store') filtered = allData.filter(item => item.collection_mode === 'store');
    else if (activeTab === 'net') filtered = allData.filter(item => item.collection_mode === 'net');
    else if (activeTab === 'sniper') filtered = allData.filter(item => item.collection_mode === 'sniper');

    if (activeTab === 'store' && activeGroup) filtered = filtered.filter(item => item.group_name === activeGroup);

    setDisplayData(filtered);
    setCurrentPage(1);
    setSelectedIds([]);
  }, [activeTab, activeGroup, allData]);

  const fetchData = async () => {
    const { data } = await supabase.from("local_data").select("*").order("created_at", { ascending: false });
    if (data) {
      setAllData(data);
      const storeData = data.filter(item => item.collection_mode === 'store');
      const uniqueGroups = Array.from(new Set(storeData.map(item => item.group_name).filter(Boolean)));
      setGroups(uniqueGroups as string[]);
    }
  };

  const indexOfLastItem = currentPage * ITEMS_PER_PAGE;
  const indexOfFirstItem = indexOfLastItem - ITEMS_PER_PAGE;
  const currentItems = displayData.slice(indexOfFirstItem, indexOfLastItem);
  const totalPages = Math.ceil(displayData.length / ITEMS_PER_PAGE);

  const toggleSelect = (id: number) => {
    if (selectedIds.includes(id)) setSelectedIds(prev => prev.filter(item => item !== id));
    else setSelectedIds(prev => [...prev, id]);
  };

  const handleDeleteSelected = async () => {
    if (selectedIds.length === 0) return alert("ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
    if (!confirm(`ì •ë§ ${selectedIds.length}ê°œì˜ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
    try {
      const { error } = await supabase.from('local_data').delete().in('id', selectedIds);
      if (error) throw error;
      alert("ì‚­ì œ ì™„ë£Œ! ğŸ§¹");
      fetchData();
    } catch (error: any) { alert(`ì‹¤íŒ¨: ${error.message}`); }
  };

  const handleSelectAll = () => {
    if (selectedIds.length === currentItems.length) setSelectedIds([]);
    else setSelectedIds(currentItems.map(item => item.id));
  };

  const delay = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));

  const processSingleUrl = async (url: string, keyword?: string, groupName?: string, collectionMode?: string) => {
    try {
      const response = await fetch("/api/crawl", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url, keyword, groupName, collectionMode }),
      });
      const text = await response.text();
      let result;
      try { result = JSON.parse(text); } catch (e) { throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜`); }
      if (!response.ok || !result.success) throw new Error(result.error || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜");
      return { success: true, count: result.count };
    } catch (error: any) { return { success: false, message: error.message }; }
  };

  const filterNewUrlsOnly = async (urls: string[]) => {
    if (urls.length === 0) return { newUrls: [], duplicateCount: 0 };
    const { data: existingItems } = await supabase.from('local_data').select('source_url').in('source_url', urls);
    const existingUrls = new Set(existingItems?.map(item => item.source_url) || []);
    const newUrls = urls.filter(url => !existingUrls.has(url));
    return { newUrls, duplicateCount: urls.length - newUrls.length };
  };

  const handleDiagnosis = async () => {
    if (!inputValue) return alert("ê°€ê²Œ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
    setIsLoading(true); setReport(null); setLogs(["ğŸ¥ ì§„ë‹¨ ì¤‘..."]);
    try {
      const response = await fetch("/api/diagnosis", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ storeName: inputValue, location: "ê°•ë¦‰" }) });
      const result = await response.json();
      if (result.success) { setReport(result.report); setLogs(["âœ… ì§„ë‹¨ ì™„ë£Œ!"]); } else { setLogs(["âŒ ì‹¤íŒ¨: " + result.error]); }
    } catch (error: any) { setLogs(["âŒ ì˜¤ë¥˜: " + error.message]); } finally { setIsLoading(false); }
  };

  const handleStart = async () => {
    if (activeTab === 'diagnosis') { handleDiagnosis(); return; }
    if (activeTab === 'all') return alert("ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ë ¤ë©´ 'ì—…ì²´ ëª¨ë“œ'ë‚˜ 'ê·¸ë¬¼ë§ ëª¨ë“œ'ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
    if (!inputValue) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
    
    setIsLoading(true); setLogs([]); setActiveGroup(null); 

    try {
      if (activeTab === 'sniper') {
        setLogs(["ğŸ¯ [ìŠ¤ë‚˜ì´í¼ ëª¨ë“œ] ì •ë°€ ë¶„ì„..."]);
        const res = await processSingleUrl(inputValue, undefined, undefined, 'sniper');
        if (res.success) { setLogs(prev => [...prev, `âœ… ì™„ë£Œ. ${res.count}ê±´ í™•ë³´.`]); setInputValue(""); } 
        else { setLogs(prev => [...prev, `âŒ ì‹¤íŒ¨: ${res.message}`]); }
      } 
      else {
        // [í•µì‹¬] ëª¨ë“œì— ë”°ë¼ ë³€ìˆ˜ ì„¤ì •
        const isStoreMode = activeTab === 'store';
        const collectionMode = isStoreMode ? 'store' : 'net';
        const targetGroup = isStoreMode ? inputValue : undefined;
        
        setLogs([`${isStoreMode ? 'ğŸ¢ [ì—…ì²´ ëª¨ë“œ]' : 'ğŸ•¸ï¸ [ê·¸ë¬¼ë§ ëª¨ë“œ]'} "${inputValue}" ê²€ìƒ‰ ì¤‘...`]);
        
        // [ì¤‘ìš”] collectionModeë¥¼ ê°™ì´ ë³´ë‚´ì¤ë‹ˆë‹¤!
        const searchRes = await fetch("/api/search", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ keyword: inputValue, collectionMode: collectionMode }),
        });
        
        const text = await searchRes.text();
        let searchResult;
        try { searchResult = JSON.parse(text); } catch (e) { throw new Error("íƒìƒ‰ì¡° ì—°ê²° ì‹¤íŒ¨."); }
        if (!searchResult.success) throw new Error(searchResult.error);
        
        const rawUrls = searchResult.urls;
        setLogs(prev => [...prev, `ğŸ” ìƒìœ„ ${rawUrls.length}ê°œ ë¸”ë¡œê·¸ ë°œê²¬.`]);
        const { newUrls, duplicateCount } = await filterNewUrlsOnly(rawUrls);

        if (duplicateCount > 0) setLogs(prev => [...prev, `ğŸ—‘ï¸ ì´ë¯¸ ìˆ˜ì§‘ëœ ${duplicateCount}ê°œ ì œì™¸.`]);
        if (newUrls.length === 0) { setLogs(prev => [...prev, "âš ï¸ ìƒˆë¡œìš´ ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤."]); setIsLoading(false); return; }

        setLogs(prev => [...prev, `âœ… ìˆ˜ì§‘ ì‹œì‘ (${newUrls.length}ê°œ)...`]);
        let successCount = 0;
        
        for (let i = 0; i < newUrls.length; i++) {
          const currentUrl = newUrls[i];
          setLogs(prev => [...prev, `ğŸ”„ [${i + 1}/${newUrls.length}] ë¶„ì„: ${currentUrl}`]);
          
          const crawlRes = await processSingleUrl(currentUrl, inputValue, targetGroup, collectionMode);
          
          if (crawlRes.success) {
            if (crawlRes.count === 0) setLogs(prev => [...prev, `   âš ï¸ íŒ¨ìŠ¤ (ê´€ë ¨ì„± ë‚®ìŒ)`]);
            else { setLogs(prev => [...prev, `   ğŸ‘‰ ì„±ê³µ!`]); successCount += crawlRes.count; }
          } else { setLogs(prev => [...prev, `   ğŸ‘‰ ì—ëŸ¬: ${crawlRes.message}`]); }
          fetchData(); 
          if (i < newUrls.length - 1) { await delay(2000); }
        }
        setLogs(prev => [...prev, "---------------------------", `ğŸ ì¢…ë£Œ. ì´ ${successCount}ê±´ ìˆ˜ì§‘.`]);
        if (isStoreMode && successCount > 0) setActiveGroup(inputValue);
        setInputValue("");
      }
      fetchData();
    } catch (error: any) { setLogs((prev) => [...prev, `â— ì˜¤ë¥˜: ${error.message}`]); } finally { setIsLoading(false); }
  };

  // ëª¨ë‹¬ ë“± ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€
  const openBlogModal = async (item: any) => {
    setSelectedItem(item); setBlogPost(""); setTrendConcepts([]); setSelectedConcept(null); setIsModalOpen(true); setIsTrendLoading(true);
    try {
      const response = await fetch("/api/trend", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ keyword: item.title, location: "ê°•ë¦‰" }) });
      const result = await response.json();
      if (result.success) setTrendConcepts(result.concepts); else alert("íŠ¸ë Œë“œ ë¶„ì„ ì‹¤íŒ¨: " + result.error);
    } catch (e) { console.error(e); } finally { setIsTrendLoading(false); }
  };
  const generateBlog = async () => {
    if (!selectedItem || !selectedConcept) return;
    setIsBlogLoading(true); setBlogPost("âœï¸ ì‘ì„± ì¤‘...");
    try {
      const response = await fetch("/api/blog", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ ...selectedItem, concept: selectedConcept }) });
      const result = await response.json();
      if (result.success) setBlogPost(result.post); else setBlogPost("âŒ ì‹¤íŒ¨: " + result.error);
    } catch (error) { setBlogPost("âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); } finally { setIsBlogLoading(false); }
  };

  return (
    <div className="min-h-screen bg-gray-50 p-8 font-sans relative">
      <div className="max-w-7xl mx-auto">
        <header className="mb-8 text-center"><h1 className="text-4xl font-bold text-gray-900 mb-2">ğŸŒŠ ê°•ë¦‰ AI ë°ì´í„° ëŒ (v8.5)</h1><p className="text-gray-600">ë„¤ì´ë²„ ìƒìœ„ ë­í‚¹ ë¸”ë¡œê·¸ ì •ë°€ íƒ€ê²©.</p></header>
        <div className="flex flex-wrap gap-2 justify-center mb-8">
           <button onClick={() => setActiveTab('all')} className={`px-6 py-3 rounded-xl font-bold transition-all ${activeTab === 'all' ? 'bg-gray-800 text-white shadow-lg' : 'bg-white text-gray-500'}`}>ğŸ—‚ï¸ ì „ì²´</button>
           <button onClick={() => setActiveTab('diagnosis')} className={`px-6 py-3 rounded-xl font-bold transition-all ${activeTab === 'diagnosis' ? 'bg-red-600 text-white shadow-lg' : 'bg-white text-gray-500'}`}>ğŸ¥ ì§„ë‹¨</button>
           <button onClick={() => setActiveTab('store')} className={`px-6 py-3 rounded-xl font-bold transition-all ${activeTab === 'store' ? 'bg-orange-600 text-white shadow-lg' : 'bg-white text-gray-500'}`}>ğŸ¢ ì—…ì²´</button>
           <button onClick={() => setActiveTab('net')} className={`px-6 py-3 rounded-xl font-bold transition-all ${activeTab === 'net' ? 'bg-purple-600 text-white shadow-lg' : 'bg-white text-gray-500'}`}>ğŸ•¸ï¸ ê·¸ë¬¼ë§</button>
           <button onClick={() => setActiveTab('sniper')} className={`px-6 py-3 rounded-xl font-bold transition-all ${activeTab === 'sniper' ? 'bg-blue-600 text-white shadow-lg' : 'bg-white text-gray-500'}`}>ğŸ¯ ìŠ¤ë‚˜ì´í¼</button>
        </div>
        {activeTab !== 'all' && (
          <div className="bg-white p-6 rounded-2xl shadow-lg mb-8 border border-gray-100 animate-fadeIn">
            <div className="flex flex-col md:flex-row gap-3">
              <input type="text" placeholder={activeTab === 'store' ? "ê°€ê²Œëª… (ì˜ˆ: êµ¬ì˜ë¶•ì–´ë¹µ)" : "ê²€ìƒ‰ì–´ ì…ë ¥"} className="flex-1 p-4 border rounded-xl text-lg" value={inputValue} onChange={(e) => setInputValue(e.target.value)} disabled={isLoading} onKeyDown={(e) => e.key === 'Enter' && handleStart()} />
              <button onClick={handleStart} disabled={isLoading} className={`px-8 py-4 rounded-xl font-bold text-white shadow-md whitespace-nowrap ${isLoading ? "bg-gray-400" : activeTab === 'store' ? "bg-orange-600" : activeTab === 'net' ? "bg-purple-600" : "bg-blue-600"}`}>{isLoading ? "ì‘ë™ ì¤‘..." : "ì‹¤í–‰"}</button>
            </div>
            {logs.length > 0 && <div className="mt-6 p-5 bg-gray-900 text-green-400 rounded-xl text-sm font-mono h-48 overflow-y-auto shadow-inner">{logs.map((log, i) => (<div key={i} className="mb-1">{log}</div>))}</div>}
            {activeTab === 'diagnosis' && report && (<div className="mt-6 bg-white border border-red-100 rounded-2xl p-6 shadow-sm"><div className="text-center mb-4"><span className="text-4xl font-bold text-red-500">{report.score}ì </span><h3 className="text-xl font-bold mt-2">{report.summary}</h3></div><div className="bg-blue-50 p-4 rounded-xl text-blue-800 font-bold">{report.solution}</div></div>)}
          </div>
        )}
        {activeTab !== 'diagnosis' && (
          <>
            {activeTab === 'store' && groups.length > 0 && (<div className="flex gap-2 overflow-x-auto pb-4 mb-2"><button onClick={() => setActiveGroup(null)} className="px-4 py-2 rounded-full font-bold bg-orange-600 text-white">ğŸ“‚ ì „ì²´</button>{groups.map((group) => (<button key={group} onClick={() => setActiveGroup(group)} className={`px-4 py-2 rounded-full font-bold border ${activeGroup === group ? 'bg-orange-500 text-white' : 'bg-white text-gray-600'}`}>ğŸ“ {group}</button>))}</div>)}
            <div className="flex justify-between items-center mb-4 px-2"><div className="flex items-center gap-2"><input type="checkbox" id="selectAll" checked={currentItems.length > 0 && selectedIds.length === currentItems.length} onChange={handleSelectAll} className="w-5 h-5 accent-blue-600" /><label htmlFor="selectAll" className="text-gray-600 font-bold cursor-pointer">ì „ì²´ ì„ íƒ</label></div>{selectedIds.length > 0 && (<button onClick={handleDeleteSelected} className="px-4 py-2 bg-red-500 text-white rounded-lg font-bold">ğŸ—‘ï¸ ì‚­ì œ ({selectedIds.length})</button>)}</div>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-10">
              {currentItems.map((item) => (
                <div key={item.id} className="bg-white rounded-2xl shadow-sm border overflow-hidden group relative">
                   <div className="absolute top-3 left-10 z-10 flex gap-1">{item.collection_mode === 'store' && <span className="bg-orange-100 text-orange-700 text-xs font-bold px-2 py-1 rounded-md">ğŸ¢ ì—…ì²´</span>}{item.group_name && <span className="bg-gray-100 text-gray-700 text-xs font-bold px-2 py-1 rounded-md">ğŸ“ {item.group_name}</span>}</div>
                   <div className="absolute top-3 left-3 z-10"><input type="checkbox" checked={selectedIds.includes(item.id)} onChange={() => toggleSelect(item.id)} className="w-6 h-6 accent-blue-600" /></div>
                   <div className="h-56 bg-gray-100 w-full relative"><img src={item.image_url || ''} alt={item.title} className="w-full h-full object-cover group-hover:scale-110 transition-transform" onError={(e) => { (e.target as HTMLImageElement).style.display = 'none'; }} /></div>
                   <div className="p-6"><h3 className="text-xl font-bold mb-3 line-clamp-1">{item.title}</h3><p className="text-gray-600 text-sm mb-4 line-clamp-3">{item.content}</p><div className="flex justify-between items-center pt-4 border-t"><a href={item.source_url} target="_blank" className="text-gray-400 text-xs">ì›ë³¸ â†—</a><button onClick={() => openBlogModal(item)} className="px-4 py-2 bg-green-500 text-white rounded-lg font-bold text-sm">âœï¸ ë§ˆì¼€íŒ…</button></div></div>
                </div>
              ))}
            </div>
            {totalPages > 1 && (<div className="flex justify-center gap-2 pb-20"><button onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))} className="px-4 py-2 bg-white border">â—€</button><span className="px-4 py-2 font-bold">{currentPage}</span><button onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))} className="px-4 py-2 bg-white border">â–¶</button></div>)}
          </>
        )}
      </div>
      {isModalOpen && (<div className="fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4"><div className="bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] flex flex-col p-6"><h3 className="text-2xl font-bold mb-4">AI ì „ëµì‹¤</h3>{!blogPost ? (<div className="flex-1 overflow-y-auto"><div className="grid grid-cols-3 gap-4">{trendConcepts.map((c: any, i) => (<button key={i} onClick={() => setSelectedConcept(c)} className={`p-4 border rounded-xl text-left ${selectedConcept === c ? 'bg-blue-50 border-blue-500' : ''}`}><h4 className="font-bold">{c.title}</h4><p className="text-sm text-gray-600 mt-2">{c.description}</p></button>))}</div><button onClick={generateBlog} disabled={!selectedConcept} className="w-full mt-6 py-3 bg-blue-600 text-white font-bold rounded-xl">ê¸€ì“°ê¸°</button></div>) : (<div className="flex-1 overflow-y-auto whitespace-pre-wrap leading-relaxed">{blogPost}</div>)}<button onClick={() => setIsModalOpen(false)} className="mt-4 py-2 text-gray-500">ë‹«ê¸°</button></div></div>)}
    </div>
  );
}
</file>

<file path="app/layout.tsx">
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

// âœ… êµ¬ê¸€ ì„œì¹˜ ì½˜ì†” ì¸ì¦ ì½”ë“œê°€ í¬í•¨ëœ ë©”íƒ€ë°ì´í„° ì„¤ì •
export const metadata: Metadata = {
  title: "ê°•ë¦‰ AI ë°ì´í„° í—ˆë¸Œ AIO",
  description: "2026 ê°•ë¦‰ ITS ì„¸ê³„ì´íšŒë¥¼ ìœ„í•œ ë¡œì»¬ ë°ì´í„° ëŒ í”„ë¡œì íŠ¸",
  verification: {
    google: "kG2m5o-XXrhcSvWHMUCNyfa9e-lvP0sTlkVw5S3L0Dg",
    // ë„¤ì´ë²„ëŠ” ì•„ë˜ì²˜ëŸ¼ 'other' í•­ëª© ì•ˆì— ë„£ì–´ì•¼ ë¡œë´‡ì´ ì¸ì‹í•©ë‹ˆë‹¤.
    other: {
      "naver-site-verification": [
        "1d5bf82000439d733a0f562fbf3e6d4be0feb07d",
      ],
    },
  },
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="ko">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        {children}
      </body>
    </html>
  );
}
</file>

</files>
